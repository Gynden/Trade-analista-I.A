function renderHistory(trades) {
  if (!trades || trades.length === 0) {
    historyEmptyEl.classList.remove("hidden");
    historyListEl.classList.add("hidden");
    historyListEl.innerHTML = "";
    return;
  }

  historyEmptyEl.classList.add("hidden");
  historyListEl.classList.remove("hidden");
  historyListEl.innerHTML = "";

  trades
    .slice()
    .reverse()
    .forEach((t) => {
      const imgUrl =
        assetImages[t.symbol] ||
        "https://upload.wikimedia.org/wikipedia/commons/3/3f/Placeholder_view_vector.svg";

      const sideBadgeClass =
        t.side === "BUY"
          ? "bg-emerald-500/10 text-emerald-300 border-emerald-400/40"
          : "bg-rose-500/10 text-rose-300 border-rose-400/40";

      // ðŸ”¹ valor de entrada = qty * price
      const hasEntry = t.qty != null && t.price != null;
      const entryValue = hasEntry ? t.qty * t.price : null;
      const entryValueText = entryValue != null ? formatBRL(entryValue) : "â€”";

      const pnlValue = t.closed_pnl ?? 0;
      const pnlText = formatBRL(Math.abs(pnlValue));
      const isWin = pnlValue > 0;
      const isLoss = pnlValue < 0;

      const pnlLabel = isWin
        ? "Lucro"
        : isLoss
        ? "PrejuÃ­zo"
        : "Resultado";

      const pnlColor = isWin
        ? "text-emerald-400"
        : isLoss
        ? "text-rose-400"
        : "text-slate-400";

      const row = document.createElement("div");
      row.className =
        "flex items-center justify-between gap-3 bg-slate-900/80 border border-slate-800 rounded-xl px-3 py-2";

      row.innerHTML = `
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-full overflow-hidden bg-slate-800 flex items-center justify-center">
            <img src="${imgUrl}" alt="${t.symbol}" class="w-full h-full object-contain" />
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span class="text-xs font-semibold">${t.symbol}</span>
              <span class="px-2 py-0.5 rounded-full text-[10px] border ${sideBadgeClass}">
                ${t.side === "BUY" ? "COMPRA" : "VENDA"}
              </span>
              ${
                t.strategy
                  ? `<span class="px-2 py-0.5 rounded-full text-[10px] bg-sky-500/10 text-sky-300 border border-sky-400/40">
                       ${t.strategy}
                     </span>`
                  : ""
              }
            </div>
            <p class="text-[11px] text-slate-400">
              Qty: <span class="font-medium text-slate-200">${t.qty}</span> Â·
              PreÃ§o: <span class="font-medium text-slate-200">${t.price?.toFixed(
                2
              )}</span>
            </p>
            <p class="text-[11px] text-slate-400">
              Valor de entrada:
              <span class="font-medium text-slate-200">${entryValueText}</span>
            </p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-[11px] text-slate-500">
            ${t.time ? new Date(t.time).toLocaleTimeString("pt-BR") : ""}
          </p>
          <p class="text-[11px] ${pnlColor}">
            ${pnlLabel}: ${pnlText}
          </p>
        </div>
      `;

      historyListEl.appendChild(row);
    });
}
